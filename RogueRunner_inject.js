(function(D,m,w,x){function q(){var d=Array.prototype.slice.call(arguments);d.unshift("RogueBM[injection]: ");console.error.apply(console,d)}function z(d,e,c){var b=document.createElement("script");b.setAttribute("type","text/javascript");if(d)b.setAttribute("src",d),b.setAttribute("crossorigin","anonymous"),b.onerror=c;else try{b.appendChild(document.createTextNode(e))}catch(h){b.text=e}return b}function A(d,e){var c=m.RogueBM.xDLStorage;c||q("Error injecting "+d," xDLStorage isn't loaded as a backup either",e);c.getScript(d,function(b,h){b&&q("Error loading script from xDLStorage",h.error);try{document.getElementsByTagName("head")[0].appendChild(z(null,h.data))}catch(l){eval(h)}})}function B(){function d(e,c,b){function h(a){console.log("got message",a);if(b.includes(a.origin)){var f=JSON.parse(a.data),n=f.error;f.error=null;delete f.error;n&&q(n,f,a);if(f.ready)console.log("doing preload handlers"),l();else if(null==f.messageID)console.error("need data.messageID for callbacks to function",a);else{var r=t[f.messageID];r?r.method!=r.method?q("methods do not match. Possible security risk"):(r.a&&r.a(n,f,a),t[f.b]=null,delete t[f.b]):q("no handler found for ",a.messageID,a)}}else console.warn("rejected post message from",a.origin,"Allowed origins are",b,"you attempted",a)}function l(){if(p){for(var a=0;a<p.length;a++)g.postMessage(JSON.stringify(p[a]),"*");p=null}}var g,p=[];domready(function(){var a=document.createElement("iframe");a.addEventListener("load",l);a.onerror=function(){alert("yeeeet")};a.src=c;a.style.display="none";a.style.position="absolute";document.body.appendChild(a);try{g=a.contentWindow}catch(f){g=a.contentWindow}a&&a.contentDocument&&g||((g=window.open(c.src||c,"RogueRunner","scrollbars=no, width=1, height=1, top=1, left=1"))&&!g.closed&&"undefined"!=typeof g.closed||alert("popup window blocked"),g.blur())});var t={};e.addEventListener?e.addEventListener("message",h,!1):e.attachEvent("onmessage",h);this.getScript=function(a,f){this.postMessage({method:"getScript",url:a},f)};this.postMessage=function(a,f){var n=Math.floor(9E9*Math.random())+1E9+"-"+Date.now();a.messageID=n;t[n]={a:f,method:a.method};null!=p?p.push(a):g.postMessage(JSON.stringify(a),"*")}}!function(e,c){"undefined"!=typeof module?module.exports=c():"function"==typeof define&&"object"==typeof define.c?define(c):this[e]=c()}("domready",function(){var e=[],c,b="object"==typeof document&&document,h=b&&b.documentElement.doScroll,l=b&&(h?/^loaded|^c/:/^loaded|^i|^c/).test(b.readyState);return!l&&b&&b.addEventListener("DOMContentLoaded",c=function(){b.removeEventListener("DOMContentLoaded",c);for(l=1;c=e.shift();)c()}),function(g){l?setTimeout(g,0):e.push(g)}});m.RogueBM.CrossOriginLocalStorage=d;m.RogueBM.xDLStorage=new d(m,"https://ktsuttlemyre.github.io/RogueBookmarklets/localstorage.html",["https://ktsuttlemyre.github.io"])}function C(d,e,c){null==c&&(c=w.forceIframeInjecting);if(e!=y)return console.error("RogueRunner[injector]: sessionID either not correct or not provided. Will not load this url",d),1;c?setTimeout(function(){A(d)},1):document.getElementsByTagName("head")[0].appendChild(z(d,null,function(b){A(d,b)}));return 0}Date.now||(Date.now=function(){return(new Date).getTime()});var k=m.RogueBM=m.RogueBM||{};k.f=function(){return x};k.show&&(k.CrossOriginLocalStorage||B(),x||k.show());var y=Math.floor(9E9*Math.random())+1E9+"-"+Date.now(),u=document.documentElement,v=w.skin;v=("all"in u.style||"cssall"in u.style)&&0!=!!v?"_"+v:"";u="https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner_src"+v+".js?user="+w.user+"&cmd="+x;k.injectScript=C;k.getSessionID=function(){prompt("Copy the session id below to use in protected RogueBM[injector] calls",y)};k.about={injector:{revision:"{{ site.github.build_revision }}",version:D}};C(u,y);B();var E="toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=300,top="+(screen.height-800)+",left="+(screen.width-300);k.open=function(d){window.open(d,"_blank",E)}})("0.0.1",window,{user:"anonymous",skin:"experimental",forceIframeInjecting:!1});
