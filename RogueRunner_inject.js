(function(E,l,x,y){function q(){var c=Array.prototype.slice.call(arguments);c.unshift("RogueBM[injection]: ");console.error.apply(console,c)}function A(c,h,d){var b=document.createElement("script");b.setAttribute("type","text/javascript");if(c)b.setAttribute("src",c),b.setAttribute("crossorigin","anonymous"),b.onerror=d;else try{b.appendChild(document.createTextNode(h))}catch(e){b.text=h}return b}function B(c,h){var d=l.RogueBM.xDLStorage;d||q("Error injecting "+c," xDLStorage isn't loaded as a backup either",h);d.getScript(c,function(b,e){b&&q("Error loading script from xDLStorage",e.error);try{document.getElementsByTagName("head")[0].appendChild(A(null,e.data))}catch(r){eval(e)}})}function C(){function c(d,b,e){function r(a){console.log("got message",a);if(e.includes(a.origin)){var f=JSON.parse(a.data),m=f.error;f.error=null;delete f.error;m&&q(m,f,a);if(f.ready)console.log("doing preload handlers"),n();else if(null==f.messageID)console.error("need data.messageID for callbacks to function",a);else{var t=u[f.messageID];t?t.method!=t.method?q("methods do not match. Possible security risk"):(t.a&&t.a(m,f,a),u[f.b]=null,delete u[f.b]):q("no handler found for ",a.messageID,a)}}else console.warn("rejected post message from",a.origin,"Allowed origins are",e,"you attempted",a)}function n(){if(p){for(var a=0;a<p.length;a++)g.postMessage(JSON.stringify(p[a]),"*");p=null}}var g,p=[];h(function(){var a=document.createElement("iframe");a.addEventListener("load",n);a.onerror=function(){alert("yeeeet")};a.src=b;a.style.display="none";a.style.position="absolute";document.body.appendChild(a);try{g=a.contentWindow}catch(f){g=a.contentWindow}a&&a.contentDocument&&g||(g=window.open(b.src||b,"RogueRunner","scrollbars=no, width=1, height=1, top=1, left=1"),g.blur())});var u={};d.addEventListener?d.addEventListener("message",r,!1):d.attachEvent("onmessage",r);this.getScript=function(a,f){this.postMessage({method:"getScript",url:a},f)};this.postMessage=function(a,f){var m=Math.floor(9E9*Math.random())+1E9+"-"+Date.now();a.messageID=m;u[m]={a:f,method:a.method};null!=p?p.push(a):g.postMessage(JSON.stringify(a),"*")}}var h=function(){var d=[],b,e="object"==typeof document&&document,r=e&&e.documentElement.doScroll,n=e&&(r?/^loaded|^c/:/^loaded|^i|^c/).test(e.readyState);return!n&&e&&e.addEventListener("DOMContentLoaded",b=function(){e.removeEventListener("DOMContentLoaded",b);n=1;for(b=d.shift();b;)b()}),function(g){n?setTimeout(g,0):d.push(g)}}();l.RogueBM.CrossOriginLocalStorage=c;l.RogueBM.xDLStorage=new c(l,"https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner.html",["https://ktsuttlemyre.github.io"])}function D(c,h,d){null==d&&(d=x.forceIframeInjecting);if(h!=z)return console.error("RogueRunner[injector]: sessionID either not correct or not provided. Will not load this url",c),1;d?setTimeout(function(){B(c)},1):document.getElementsByTagName("head")[0].appendChild(A(c,null,function(b){B(c,b)}));return 0}Date.now||(Date.now=function(){return(new Date).getTime()});var k=l.RogueBM=l.RogueBM||{};k.c=function(){return y};k.show&&(k.CrossOriginLocalStorage||C(),y||k.show());var z=Math.floor(9E9*Math.random())+1E9+"-"+Date.now(),v=document.documentElement,w=x.skin;w=("all"in v.style||"cssall"in v.style)&&0!=!!w?"_"+w:"";v="https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner_src"+w+".js?user="+x.user+"&cmd="+y;k.injectScript=D;k.getSessionID=function(){prompt("Copy the session id below to use in protected RogueBM[injector] calls",z)};k.about={injector:{revision:"{{ site.github.build_revision }}",version:E}};D(v,z);C();var F="toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=300,top="+(screen.height-800)+",left="+(screen.width-300);k.open=function(c){window.open(c,"_blank",F)}})("0.0.1",window,{user:"anonymous",skin:"experimental",forceIframeInjecting:!1});
