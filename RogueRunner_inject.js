(function(k,t,G,M,p,l,H,N,R,B,w){function I(){return(Math.floor(9E15*Math.random())+1).toString(36)+"-"+(new Date).getTime().toString(36)}function y(){var a=Array.prototype.slice.call(arguments);a.unshift("RogueBM[injection]: ");p.error.apply(p,a)}function J(a,c,b){"string"==typeof a&&(a=t.createElement(a));for(var d=Object.keys(c),e=0,q=d.length;e<q;e++)0<=S.indexOf(d[e])?a.setAttribute(d[e],c[d[e]]):a[d[e]]=c[d[e]];b&&b.appendChild(a);return a}function C(a,c,b,d){function e(m,n){if(!v)if(c())v=!0,g.loaded(a),b&&b.call&&b();else{if(m||100<=q++)return d?l(function(){T[d](a,c,b)},1):b&&l(function(){b("error:inlining failed")},1);n&&(q=100,l(function(){c()||O(null,n)},1),l(function(){c()||(new Function(n))()},1),l(function(){c()||eval(n)},1));l(e,100)}}var q=0,v=!1;return e}function O(a,c,b){b=b&&b.call?b:function(e){e&&y(e)};var d=J("script",{type:"text/javascript",id:"injected_"+I()+"_"+U++});if(c)try{d.appendChild(t.createTextNode(c))}catch(e){d.text=c,l(function(){b(null,c)},1)}else J(d,{src:a,f:"anonymous"}),d.onerror=d.onload=b,l(b,1);t.getElementsByTagName("head")[0].appendChild(d);return d}function V(a,c){var b=k.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onreadystatechange=function(){4==b.readyState&&(200==b.status||0==b.status?c(null,b.responseText):c(b.status))};try{b.open("GET",a,!0),b.send()}catch(d){c(d)}}function P(){function a(c,b,d){function e(f){p.log("got message",f);if(d.includes(f.origin)){var h=null;try{h=H.parse(f.data)}catch(Y){h=f.data;"RogueRunner:Blur"==h&&(r.display="none");return}var x=h.error;h.error=null;delete h.error;if(x)y(x,h,f);else if(h.ready)p.log("doing preload handlers"),q();else if(null==h.messageID)p.error("need data.messageID for callbacks to function",f);else{var z=D[h.messageID];z?z.method!=z.method?y("methods do not match. Possible security risk"):(z.a&&z.a(x,h,f),D[h.messageID]=null,delete D[h.messageID]):y("no handler found for ",f.messageID,f)}}else p.warn("rejected post message from",f.origin,"Allowed origins are",d,"you attempted",f)}function q(){clearTimeout(0);v.status="ready";if(n){for(var f=0;f<n.length;f++)m.postMessage(H.stringify(n[f]),"*");n=null}}var v=this,m,n=[];v.status="loading";var u,r,Q;k.b(function(){if(!B.forcePopOut){u=J("iframe",{onerror:function(){v.status="blocked"},frameBorder:0,allowTransparency:"true",src:b,style:"background-color:transparent;display:none;position:absolute"},t.body);u.addEventListener("load",q);r=u.style;try{m=u.contentWindow}catch(f){m=u.contentWindow}}if(!u||!u.contentDocument||!m){u=null;m=Q=k.open(b.src||b,"RogueRunner","scrollbars=no, width=1, height=1, top=1, left=1");if(!m||m.closed||"undefined"==typeof m.closed)v.status="blocked";m.blur()}});var D={};c.addEventListener?c.addEventListener("message",e,!1):c.attachEvent("onmessage",e);this.getScript=function(f,h){this.postMessage({method:"getScript",url:f},h)};this.postMessage=function(f,h){f.messageID=I();D[id]={a:h,method:f.method};null!=n?n.push(f):m.postMessage(H.stringify(f),"*")};this.convertToInterface=function(){this.postMessage({method:"convertToInterface"},function(f,h){h.data&&(u&&(r.width=r.height="100%",r.display="block",r.position="absolute",r.bottom=r.right="0",r.border="0",g.show=function(){r.display="block"},t.addEventListener("keyup",function(x){x.ctrlKey&&192==x.keyCode&&g.show()},!1)),Q&&N("not implemented yet"))})}}k.b=function(){var c=[],b,d=(t.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(t.readyState);return!d&&t.addEventListener("DOMContentLoaded",b=function(){t.removeEventListener("DOMContentLoaded",b);for(d=1;b=c.shift();)b()}),function(e){d?l(e,0):c.push(e)}}();g.CrossOriginLocalStorage=a;g.xDLStorage=new a(k,"https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner.html#localstorage",["https://ktsuttlemyre.github.io"])}function E(a,c,b){if(c!=A)return p.error("RogueRunner[injector]: sessionID either not correct or not provided. Will not load this url",a),1;var d=C(a,b,function(){p.log("####complete#####")},"localstorage");B.forceIframeInject?l(function(){d("forced error")},1):O(a,!1,d);return 0}var g=k.RogueBM=k.RogueBM||{};w==String.fromCharCode(37,115)&&(w="");var S=["style"],T={i:function(a,c,b,d){a=1;c=k.screenLeft||k.screenX||0;b=k.innerWidth||G.clientWidth||screen.width||0;null==a&&(a=b/k.screen.availWidth||1);a=k.open("https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner.html","RogueRunner","scrollbars=no, width="+500/a+", height="+200/a+", top=0, left="+((b-500)/2/a+c));a.focus&&a.focus();a&&!a.closed&&"undefined"!=typeof a.closed||N("RogueRunner external window popup blocked");d&&d.call&&d()},g:function(a,c,b){a===K&&(p.log("using iframe embed for RogueRunner only"),a=C(a,c,b,"popup"),g.xDLStorage.convertToInterface(a),l(a,1))},c:function(a,c,b){c=C(a,c,b,"iframe");V(a,c);l(c,1)},h:function(a,c,b){var d=C(a,c,b,"ajax");g.xDLStorage.getScript(a,function(e,q){e?y("Error loading script from xDLStorage",e):d(e,q&&q.data)});l(d,1)}},U=0;g.lastCMD=w;if(g.show)g.CrossOriginLocalStorage||P(),w||g.show();else{var F=B.skin;F=("all"in G.style||"cssall"in G.style)&&0!=!!F?"_"+F:"";var K="https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner_src"+F+".js?user="+M(B.user);w&&(K+="&cmd="+M(w));var L=["RogueRunner.js","index.js","js-yaml.min.js"],W=[];g.loaded=function(a){p.log("loaded",a);a=a.split("/").pop();W.push(a);L=L.filter(function(c){return c!=a});!L.length&&g.init()};var A=I();P();E("https://ktsuttlemyre.github.io/RogueBookmarklets/libs/js-yaml.min.js",A,function(){return k.jsyaml});E("https://ktsuttlemyre.github.io/RogueBookmarklets/index.js",A,function(){return g.scripts});E(K,A,function(){return g.loaded});g.injectScript=E;g.getSessionID=function(){prompt("Copy the session id below to use in protected RogueBM[injector] calls",A)};g.about={injector:{revision:"{{ site.github.build_revision }}",version:R}};var X="toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=300,top="+(screen.height-800)+",left="+(screen.width-300);g.open=function(a){k.open(a,"_blank",X)}}})(this,document,document.documentElement,encodeURIComponent,console,setTimeout,JSON,alert,"0.0.5",{user:"anonymous",skin:"experimental"},"%s");
