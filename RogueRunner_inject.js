(function(F,m,r,u){function v(){var d=Array.prototype.slice.call(arguments);d.unshift("RogueBM[injection]: ");console.error.apply(console,d)}function B(d,e,b){var c=document.createElement("script");c.setAttribute("type","text/javascript");if(d)c.setAttribute("src",d),c.setAttribute("crossorigin","anonymous"),c.onerror=b;else try{c.appendChild(document.createTextNode(e))}catch(h){c.text=e}return c}function C(d,e){var b=m.RogueBM.xDLStorage;b.getScript(d,function(c,h){c&&v("Error loading script from xDLStorage",error);document.getElementsByTagName("head")[0].appendChild(B(null,h.data));setTimeout(function(){e()||eval(h.data)},10);d==z&&setTimeout(function(){console.log("doin external probably");e()||(console.log("using iframe embed"),b.convertToInterface())},10)})}function D(){function d(e,b,c){function h(a){console.log("got message",a);if(c.includes(a.origin)){var f=JSON.parse(a.data),n=f.error;f.error=null;delete f.error;n&&v(n,f,a);if(f.ready)console.log("doing preload handlers"),p();else if(null==f.messageID)console.error("need data.messageID for callbacks to function",a);else{var t=w[f.messageID];t?t.method!=t.method?v("methods do not match. Possible security risk"):(t.a&&t.a(n,f,a),w[f.b]=null,delete w[f.b]):v("no handler found for ",a.messageID,a)}}else console.warn("rejected post message from",a.origin,"Allowed origins are",c,"you attempted",a)}function p(){clearTimeout(0);l.status="ready";if(q){for(var a=0;a<q.length;a++)g.postMessage(JSON.stringify(q[a]),"*");q=null}}var l=this,g,q=[];l.status="loading";domready(function(){if(!r.forcePopOut){var a=document.createElement("iframe");a.addEventListener("load",p);a.onerror=function(){l.status="blocked"};a.src=b;a.style.display="none";a.style.position="absolute";document.body.appendChild(a);try{g=a.contentWindow}catch(f){g=a.contentWindow}}if(!a||!a.contentDocument||!g){g=window.open(b.src||b,"RogueRunner","scrollbars=no, width=1, height=1, top=1, left=1");if(!g||g.closed||"undefined"==typeof g.closed)l.status="blocked";g.blur()}});var w={};e.addEventListener?e.addEventListener("message",h,!1):e.attachEvent("onmessage",h);this.getScript=function(a,f){this.postMessage({method:"getScript",url:a},f)};this.postMessage=function(a,f){var n=Math.floor(9E9*Math.random())+1E9+"-"+Date.now();a.messageID=n;w[n]={a:f,method:a.method};null!=q?q.push(a):g.postMessage(JSON.stringify(a),"*")};this.convertToInterface=function(){this.postMessage({method:"convertToInterface"},function(){alert("now interface")})}}!function(e,b){"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.c?define(b):this[e]=b()}("domready",function(){var e=[],b,c="object"==typeof document&&document,h=c&&c.documentElement.doScroll,p=c&&(h?/^loaded|^c/:/^loaded|^i|^c/).test(c.readyState);return!p&&c&&c.addEventListener("DOMContentLoaded",b=function(){c.removeEventListener("DOMContentLoaded",b);for(p=1;b=e.shift();)b()}),function(l){p?setTimeout(l,0):e.push(l)}});m.RogueBM.CrossOriginLocalStorage=d;m.RogueBM.xDLStorage=new d(m,"https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner.html#localstorage",["https://ktsuttlemyre.github.io"])}function A(d,e,b){if(e!=x)return console.error("RogueRunner[injector]: sessionID either not correct or not provided. Will not load this url",d),1;r.forceIframeInjecting?setTimeout(function(){C(d,b)},1):document.getElementsByTagName("head")[0].appendChild(B(d,null,function(){C(d,b)}));return 0}Date.now||(Date.now=function(){return(new Date).getTime()});var k=m.RogueBM=m.RogueBM||{};k.lastCMD=function(){return u};k.show&&(k.CrossOriginLocalStorage||D(),u||k.show());var E=document.documentElement,y=r.skin;y=("all"in E.style||"cssall"in E.style)&&0!=!!y?"_"+y:"";var z="https://ktsuttlemyre.github.io/RogueBookmarklets/RogueRunner_src"+y+".js?user="+r.user;u&&(z+="&cmd="+u);var x=Math.floor(9E9*Math.random())+1E9+"-"+Date.now();(function(){A("https://ktsuttlemyre.github.io/RogueBookmarklets/index.js?user="+r.user,x,function(){return window.RogueBM.scripts});A(z,x,function(){return window.RogueBM.loaded})})();D();k.injectScript=A;k.getSessionID=function(){prompt("Copy the session id below to use in protected RogueBM[injector] calls",x)};k.about={injector:{revision:"{{ site.github.build_revision }}",version:F}};var G="toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=300,top="+(screen.height-800)+",left="+(screen.width-300);k.open=function(d){window.open(d,"_blank",G)}})("0.0.1",window,{user:"anonymous",skin:"experimental",forceIframeInjecting:!1});
